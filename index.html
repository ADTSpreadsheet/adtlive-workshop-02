<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ADTLive Workshop [02]</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 {
      color: #1e40af;
      text-align: center;
    }
    .center {
      text-align: center;
    }
    .box {
      background: #f0f4ff;
      padding: 1rem;
      border-radius: 8px;
    }
    input[type="text"] {
      padding: 10px;
      width: 280px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      padding: 10px 20px;
      font-size: 1rem;
      margin-top: 10px;
      background-color: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <h1>ADTLive Workshop [02]</h1>
  <p class="center">
    ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏£‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Design<br>
    ‡∏ó‡∏≥ Workshop ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ ADTSpreadsheet<br>
    ‡πÅ‡∏ö‡∏ö Step By Step
  </p>

  <hr>

  <div class="box">
    <h2 style="margin: 0;">üé§ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£</h2>
    <p><strong>‡∏ô‡∏≤‡∏¢‡∏ä‡πà‡∏≤‡∏á‡∏≠‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡πÅ‡∏ã‡πâ‡∏ô‡∏™‡∏µ‡∏î‡∏≤</strong> (‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°)</p>
    <p>üìÖ ‡πÄ‡∏™‡∏≤‡∏£‡πå ‡∏ó‡∏µ‡πà 31 ‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏° ‡∏û.‡∏®. 2568 | üïñ 19:00 - 22:30 ‡∏ô.</p>
  </div>

  <div style="text-align: center; margin-top: 3rem;">
    <p style="font-weight: bold;">
      üì≤ ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° <strong>ADTLine-Bot</strong> ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô<br>
      ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏≠‡∏ó
    </p>
    <img src="https://wpxpukbvynxawfxcdroj.supabase.co/storage/v1/object/public/adtliveworkshop//ADTLine-Bot.jpg"
         alt="QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏≠‡∏ó"
         width="180" style="margin: 1rem auto; border-radius: 10px; border: 1px solid #ccc; box-shadow: 2px 2px 10px rgba(0,0,0,0.1);">
    <p style="max-width: 500px; margin: auto; font-size: 1rem;">
      üü£ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏¥‡∏°‡∏û‡πå <strong style="color:#2563eb;">req_refcode</strong><br>
      ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö Ref.Code ‡∏à‡∏≤‡∏Å‡∏ö‡∏≠‡∏ó‡∏ó‡∏≤‡∏á LINE ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    </p>
  </div>

  <!-- Ref.Code -->
  <div class="center" style="margin-top: 3rem;">
    <label><strong>üîê ‡∏Å‡∏£‡∏≠‡∏Å Ref.Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô:</strong></label><br><br>
    <input type="text" id="refcode" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå Ref.Code ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö">
    <button onclick="submitRefCode()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
  <div id="register-form" class="center hidden" style="margin-top: 2rem;">
    <h3 style="color:#1e3a8a;">üì• ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ Workshop</h3>
    <input type="text" id="first_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á"><br><br>
    <input type="text" id="last_name" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"><br><br>
    <input type="text" id="phone_number" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"><br><br>
    <input type="text" id="serial_key" placeholder="Serial Key ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö"><br><br>

    <p><strong>‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ADTSpreadsheet ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</strong></p>
    <input type="radio" id="has_program_yes" name="has_program" value="yes">
    <label for="has_program_yes">‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß</label><br>
    <input type="radio" id="has_program_no" name="has_program" value="no">
    <label for="has_program_no">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ</label><br><br>

    <div id="license_no_field" class="hidden">
      <input type="text" id="license_no" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç License No. ‡πÄ‡∏ä‡πà‡∏ô ADT015"><br><br>
    </div>

    <button id="confirmBtn" onclick="submitFinal()" class="hidden">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
  </div>

  <!-- SCRIPT ZONE -->
  <script>
    async function submitRefCode() {
      const refCode = document.getElementById('refcode').value.trim();
      if (!refCode) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Ref.Code ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö');
        return;
      }

      try {
        const response = await fetch("https://line-bot-adt.onrender.com/verify-refcode", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ref_code: refCode })
        });

        const data = await response.json();

        if (response.ok) {
          alert("‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
          document.getElementById("register-form").classList.remove("hidden");
          document.getElementById("serial_key").value = data.serial_key || "";
        } else {
          alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ:\n" + data.error);
        }

      } catch (err) {
        alert("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠:\n" + err.message);
      }
    }

    async function submitFinal() {
      const refCode = document.getElementById('refcode').value.trim();
      const firstName = document.getElementById('first_name').value.trim();
      const lastName = document.getElementById('last_name').value.trim();
      const phoneNumber = document.getElementById('phone_number').value.trim();
      const serialKey = document.getElementById('serial_key').value.trim();
      const hasProgram = document.querySelector('input[name="has_program"]:checked');
      const licenseNo = document.getElementById('license_no').value.trim();

      if (!firstName || !lastName || !phoneNumber || !serialKey || !hasProgram) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
        return;
      }

      const payload = {
        ref_code: refCode,
        serial_key: serialKey,
        first_name: firstName,
        last_name: lastName,
        phone_number: phoneNumber,
        student_status: hasProgram.value === 'yes' ? licenseNo : 'attendees'
      };

      try {
        const response = await fetch("https://line-bot-adt.onrender.com/adtliveworkshop/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (response.ok) {
          window.location.href = "/thank-you.html";
          return;
        } else {
          alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ:\n" + data.error);
        }

      } catch (err) {
        alert("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠:\n" + err.message);
      }
    }

    document.getElementById('has_program_yes').addEventListener('change', () => {
      document.getElementById('license_no_field').classList.remove('hidden');
    });

    document.getElementById('has_program_no').addEventListener('change', () => {
      document.getElementById('license_no_field').classList.add('hidden');
    });

    const radios = document.querySelectorAll('input[name="has_program"]');
    const confirmBtn = document.getElementById('confirmBtn');
    radios.forEach((r) => {
      r.addEventListener('change', () => {
        confirmBtn.classList.remove('hidden');
      });
    });
  </script>

</body>
</html>
